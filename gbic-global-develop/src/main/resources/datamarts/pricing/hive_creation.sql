CREATE DATABASE IF NOT EXISTS {{ project.prefix }}GBIC_GLOBAL_DM_PRICING;

USE {{ project.prefix }}GBIC_GLOBAL_DM_PRICING;

CREATE TABLE IF NOT EXISTS GBIC_GLOBAL_DM_PRICING_SAMPLE(
    msisdn_id          string,
    customer_id        string,
    subscription_id    string
) COMMENT ''
PARTITIONED BY (
    type               string,
    gbic_op_id         int,
    month              string,
    pre_post_id        string
)
STORED AS ORC;

CREATE TABLE IF NOT EXISTS GBIC_GLOBAL_DM_PRICING_DATA(
    dm_change_ind              int    COMMENT 'IF there is a change of segment',
    gbic_op_name               string COMMENT 'GBIC GLOBAL OPERATOR NAME',
    currency                   string COMMENT 'Type of currency',
    msisdn_id                  string COMMENT 'Uniq ifentification of the line',
    subscription_id            string COMMENT 'Subscription identifier',
    imsi_id                    string COMMENT 'International Mobile Subscriber Identity',
    customer_id                string COMMENT 'Customer ifentifier',
    mobile_customer_id         string COMMENT 'Client code unique mobile lines',
    party_type_cd              bigint COMMENT 'Type of customer identification code',
    activation_dt              string COMMENT 'Discharge date line',
    prod_type_cd               string COMMENT 'Local line type identifier code',
    imei_num                   bigint COMMENT 'International Mobile System Equipment Identity',
    tac_id                     int    COMMENT 'First eight digits of the IMEI',
    des_manufact               string COMMENT 'Manufact description',
    des_model                  string COMMENT 'Model description',
    market_category            string COMMENT 'Market device category',
    tef_category               string COMMENT 'Telefonica internal device category',
    os                         string COMMENT 'Operating sytem',
    version_os                 string COMMENT 'Operating sytem version',
    technology                 string COMMENT 'Technology of handset (2G, 3G, 4G)',
    line_status_cd             string COMMENT 'Line status code',
    seg_local_cd               string COMMENT 'Local organizational segment identifier code',
    seg_local_name             string COMMENT 'Local organizational segment name',
    seg_global_id              int    COMMENT 'Global organizational segment identifier',
    seg_global_name            string COMMENT 'Global organizational segment name',
    pre_post_id                string COMMENT 'Contract type identifier',
    account_id                 string COMMENT 'Account identifier',
    tariff_plan_id             string COMMENT 'Tariff plan ifentifier',
    tariff_plan_des            string COMMENT 'Tariff plan description',
    postal_cd                  string COMMENT 'Postal code',
    multisim_ind               bigint COMMENT 'Multisim indicator',
    exceed_ind                 bigint COMMENT 'Exhaustion indicator franchise linked to online data',
    data_tariff_ind            bigint COMMENT 'Data tariff indicator',
    extra_data_num             bigint COMMENT 'Number of hired extras data',
    extra_data_rv              double COMMENT 'Revenue generated by hiring extra data',
    extra_data_qt              bigint COMMENT 'Amount of extra data hired by the line in the month',
    ppu_num                    bigint COMMENT 'Number of Pay Per Use bonus hired',
    ppu_rv                     double COMMENT 'Revenue generated by hiring Pay Per Use bonus',
    ppu_qt                     bigint COMMENT 'Amount of MB hired in Pay Per Use bonus in the month',
    data_consumed_qt           double COMMENT 'Data consumed by line',
    data_bundled_qt            double COMMENT 'Data bundled by line',
    call_voice_qt              bigint COMMENT 'Number of calls made by the line',
    voice_consumed_qt          double COMMENT 'Minutes consumed by the line',
    sms_consumed_qt            bigint COMMENT 'SMS sent by the line',
    prepaid_top_up_id          bigint COMMENT 'Recharger park identifier',
    top_up_cost_num            bigint COMMENT 'Number of refills cost',
    top_up_cost_rv             double COMMENT 'Amount for refills cost',
    top_up_promo_num           bigint COMMENT 'Promotional number of refills',
    top_up_promo_rv            double COMMENT 'Promotional amount for refills',
    no_top_up_rv               double COMMENT 'Total revenues of the line in the month (no refills)',
    total_rv                   double COMMENT 'Total revenues in the month online',
    bta_ind                    int    COMMENT 'Indicates record is target for Beyond the Allowance initiative',
    quota_data_rv              double COMMENT 'Data revenues',
    quota_voice_rv             double COMMENT 'Voice revenues',
    quota_mess_rv              double COMMENT 'Messaging revenues',
    quota_agg_rv               double COMMENT 'Aggregate revenues',
    traffic_data_rv            double COMMENT 'Traffic Data revenues',
    traffic_voice_rv           double COMMENT 'Traffic Voice revenues',
    traffic_mess_rv            double COMMENT 'Traffic Messaging revenues',
    traffic_agg_rv             double COMMENT 'Traffic Aggregate revenues',
    roaming_rv                 double COMMENT 'Roaming revenues',
    sva_rv                     double COMMENT 'Revenue from value-added services',
    packs_rv                   double COMMENT 'Income from hired packages',
    top_up_ex_rv               double COMMENT 'Income balances expired',
    top_up_co_rv               double COMMENT 'Income consumption refills',
    gb_camp_rv                 double COMMENT 'Returns and campaigns',
    others_rv                  double COMMENT 'Other income not fall into any classification',
    tot_rv                     double COMMENT 'total revenue',
    top_up_rv                  double COMMENT 'Total amount recharged',
    itx_rv                     double COMMENT 'Interconnection revenues (voice + sms)',
    exp_itx_rv                 double COMMENT 'Interconnection expenses (voice + sms)',
    total_invoice_rv           double COMMENT 'Sum of total revenue billed to the line',
    billing_cycle_id           string COMMENT 'Billing cycle code',
    fixed_out                  double COMMENT 'Total outgoing minutes Off Net to Fix number + Total outgoing minutes Off Net to Fix number',
    min_offnet_mobile_out      double COMMENT 'Total outgoing minutes to mobiles Off Net',
    min_onnet_mobile_out       double COMMENT 'Total outgoing minutes to mobiles On Net',
    free_and_rcm_out           double COMMENT 'Total outgoing minutes to Free numbers + Total outgoing minutes On Net to Movistar Corporation Net (RCM)',
    other_out                  double COMMENT 'Total outgoing international minutes + Total outgoing minutes to short numbers + Total outgoing minutes Roaming',
    out_national_onnet_rv      double COMMENT 'National Outgoing Revenues On Net',
    out_national_offnet_rv     double COMMENT 'National Outgoing Revenues Off Net',
    out_national_fixed_rv      double COMMENT 'National Outgoing Revenues to Fix',
    other_out_rv               double COMMENT 'International Outgoing Revenues +Roaming Revenues + Outgoing Revenues',
    min_out_bundled            double COMMENT 'Total outgoing minutes a Fijos incuded in the Bundle + Total outgoing minutes to Mobile incuded in the Bundle',
    min_out_not_bundled        double COMMENT 'Total outgoing minutes to Fix Not incuded in the Bund + Total outgoing minutes to Mobile Not incuded in the Bundle',
    min_out_exceed             double COMMENT 'To Total outgoing minutes to Mobile Exceeded + Total outgoing minutes to Fix Exceeded',
    min_2g_out                 double COMMENT 'Outcogoing minutes in  2G net',
    min_3g_out                 double COMMENT 'Outcogoing minutes in  3G net',
    min_4g_out                 double COMMENT 'Outcogoing minutes in  4G net',
    sms_offnet_out_qt          int    COMMENT 'Outgoing  SMS Off Net',
    sms_onnet_out_qt           int    COMMENT 'Outgoing SMS On Net',
    sms_international_out_qt   int    COMMENT 'International Outgoing SMS',
    sms_roaming_out_qt         int    COMMENT 'Outgoing Roaming SMS',
    sms_out_bundled_rv         double COMMENT 'Total Outgoing SMS Revenue included in the Bundle',
    sms_out_not_bundled_rv     double COMMENT 'Total Outgoing SMS Revenue nor included in the Bundle',
    sms_roaming_out_rv         double COMMENT 'Outgoing Roaming SMS Revenue',
    total_qt                   double COMMENT 'Mb of data Quantity',
    mb_2g_qt                   double COMMENT 'Mb of data Quantity  in 2G net',
    mb_3g_qt                   double COMMENT 'Mb of data Quantity  in 3G net',
    mb_4g_qt                   double COMMENT 'Mb of data Quantity  in 4G net',
    mb_roaming                 double COMMENT 'Mb of data Quantity  in Roaming'
) COMMENT ''
PARTITIONED BY (
    gbic_op_id                 int    COMMENT 'GBIC GLOBAL OPERATOR ID',
    month                      string COMMENT 'Date of monthly files',
    type                       string COMMENT 'Forward vs Backward serie')
STORED AS ORC;

CREATE TABLE IF NOT EXISTS GBIC_GLOBAL_DM_PRICING_DATA_DAILY_TRAFFIC(
    gbic_op_name    string COMMENT 'GBIC GLOBAL OPERATOR NAME',
    call_dt         string COMMENT 'Date of the call',
    msisdn_id       string COMMENT 'Unique identifier of the line encrypted as a String',
    imei_num        bigint COMMENT 'International Mobile System Equipment Identity',
    day_type_cd     string COMMENT 'Day of the call',
    bank_holiday_cd int    COMMENT 'Bank holiday identifier',
    roaming_cd      int    COMMENT 'Roaming indicator',
    calls_total_qt  int    COMMENT 'Total number of calls',
    minutes_tot_qt  double COMMENT 'Total duration (minutes)',
    sms_total_qt    int    COMMENT 'Total number of messages',
    mb_total_qt     double COMMENT 'Total mb consumed',
    subscription_id string COMMENT 'Subscription identifier'   
) COMMENT ''
PARTITIONED BY (
    gbic_op_id      int    COMMENT 'GBIC GLOBAL OPERATOR ID',
    month           string COMMENT 'Date of monthly files')
STORED AS ORC;
